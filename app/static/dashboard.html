<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WorkBoard AI Usage Catalog</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'DM Sans', system-ui, sans-serif; }
    /* Custom fast tooltips */
    .tooltip-wrapper {
      position: relative;
    }
    .tooltip-wrapper::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 10px;
      background: #1f2937;
      color: white;
      font-size: 12px;
      font-weight: 500;
      border-radius: 6px;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.15s, visibility 0.15s;
      pointer-events: none;
      margin-bottom: 6px;
      z-index: 50;
    }
    .tooltip-wrapper:hover::after {
      opacity: 1;
      visibility: visible;
      transition-delay: 0.2s;
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;

    // Icons
    const LogOut = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>;
    const User = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
    const Users = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
    const Layers = ({ className, style }) => <svg className={className} style={style} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>;
    const CheckCircle2 = ({ className, style }) => <svg className={className} style={style} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>;
    const DollarSign = ({ className, style }) => <svg className={className} style={style} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
    const Clock = ({ className, style }) => <svg className={className} style={style} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
    const Award = ({ className, style }) => <svg className={className} style={style} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>;
    const Zap = ({ className, style }) => <svg className={className} style={style} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>;
    const ChevronDown = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m6 9 6 6 6-6"/></svg>;
    const ChevronRight = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m9 18 6-6-6-6"/></svg>;
    const Building2 = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></svg>;
    const Sparkles = ({ className, style }) => <svg className={className} style={style} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>;
    const MousePointerClick = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m9 9 5 12 1.8-5.2L21 14Z"/><path d="M7.2 2.2 8 5.1"/><path d="m5.1 8-2.9-.8"/><path d="M14 4.1 12 6"/><path d="m6 12-1.9 2"/></svg>;
    const ExternalLink = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>;
    const FileText = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>;
    const BarChart3 = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>;
    const PlusCircle = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>;
    const Settings = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>;
    const Sliders = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/></svg>;
    const X = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
    const Check = ({ className }) => <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>;

    const TODAY_DATE = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

    // WorkBoard Color Palette
    const COLORS = {
      primary: '#52bad5',      // WorkBoard main
      primaryDark: '#3a9cb8',  // Darker variation
      primaryLight: '#7fcce3', // Lighter variation
      secondary: '#2d7a8c',    // Deep teal
      accent1: '#45a5c0',      // Mid teal
      accent2: '#8fd4e8',      // Soft teal
      accent3: '#1e5c6b',      // Dark teal
      success: '#3dad7a',      // Green for cost savings
      warning: '#e8a838',      // Amber for new capability
      purple: '#7b68a6',       // Purple accent
      slate: '#64748b'         // Neutral
    };

    // Sample Data
    const DASHBOARD_DATA = {
      summary: { 
        totalWorkflows: 47, 
        totalTasks: 124, 
        totalExperiments: 23, 
        totalAnnualCostSavings: 2450000,
        totalHoursSaved: 18720, 
        qualityImpactCount: 27,
        newCapabilityCount: 18,
        totalUsers: 156 
      },
      byCategory: {
        workflows: { count: 47, annualCostSavings: 980000, hoursSaved: 8320, impactBreakdown: { costSavings: 28, timeSavings: 32, qualityImprovement: 12, newCapability: 8 } },
        tasks: { count: 124, annualCostSavings: 1320000, hoursSaved: 9400, impactBreakdown: { costSavings: 45, timeSavings: 89, qualityImprovement: 12, newCapability: 7 } },
        experimentation: { count: 23, annualCostSavings: 150000, hoursSaved: 1000, impactBreakdown: { costSavings: 6, timeSavings: 12, qualityImprovement: 3, newCapability: 3 } }
      },
      byFunction: [
        { function: 'Sales', workflows: 12, tasks: 34, experiments: 5, annualCostSavings: 545000, hoursSaved: 4200, qualityImpact: 6, newCapability: 4, users: 28 },
        { function: 'Marketing', workflows: 8, tasks: 22, experiments: 4, annualCostSavings: 362000, hoursSaved: 2800, qualityImpact: 4, newCapability: 3, users: 18 },
        { function: 'Engineering', workflows: 9, tasks: 28, experiments: 8, annualCostSavings: 520000, hoursSaved: 3900, qualityImpact: 5, newCapability: 4, users: 32 },
        { function: 'Customer Success', workflows: 6, tasks: 18, experiments: 2, annualCostSavings: 285000, hoursSaved: 2100, qualityImpact: 4, newCapability: 2, users: 22 },
        { function: 'Support', workflows: 5, tasks: 12, experiments: 2, annualCostSavings: 245000, hoursSaved: 1900, qualityImpact: 3, newCapability: 2, users: 16 },
        { function: 'Product', workflows: 4, tasks: 6, experiments: 1, annualCostSavings: 215000, hoursSaved: 1600, qualityImpact: 2, newCapability: 1, users: 14 },
        { function: 'Finance', workflows: 2, tasks: 3, experiments: 1, annualCostSavings: 158000, hoursSaved: 1200, qualityImpact: 2, newCapability: 1, users: 12 },
        { function: 'HR', workflows: 1, tasks: 1, experiments: 0, annualCostSavings: 120000, hoursSaved: 1020, qualityImpact: 1, newCapability: 1, users: 14 }
      ],
      byTeam: {
        'Sales': [
          { team: 'NA', workflows: 5, tasks: 14, experiments: 2, annualCostSavings: 245000, hoursSaved: 1800, users: 12 },
          { team: 'EMEA', workflows: 4, tasks: 12, experiments: 2, annualCostSavings: 185000, hoursSaved: 1400, users: 9 },
          { team: 'Enterprise', workflows: 2, tasks: 5, experiments: 1, annualCostSavings: 75000, hoursSaved: 650, users: 4 },
          { team: 'SMB', workflows: 1, tasks: 3, experiments: 0, annualCostSavings: 40000, hoursSaved: 350, users: 3 }
        ],
        'Marketing': [
          { team: 'Content', workflows: 3, tasks: 10, experiments: 2, annualCostSavings: 145000, hoursSaved: 1100, users: 6 },
          { team: 'Demand Gen', workflows: 3, tasks: 7, experiments: 1, annualCostSavings: 122000, hoursSaved: 950, users: 5 },
          { team: 'Brand', workflows: 2, tasks: 5, experiments: 1, annualCostSavings: 95000, hoursSaved: 750, users: 7 }
        ],
        'Engineering': [
          { team: 'Backend', workflows: 4, tasks: 12, experiments: 4, annualCostSavings: 235000, hoursSaved: 1750, users: 14 },
          { team: 'Frontend', workflows: 3, tasks: 10, experiments: 3, annualCostSavings: 165000, hoursSaved: 1250, users: 10 },
          { team: 'DevOps', workflows: 2, tasks: 6, experiments: 1, annualCostSavings: 120000, hoursSaved: 900, users: 8 }
        ],
        'Customer Success': [
          { team: 'Enterprise CS', workflows: 3, tasks: 9, experiments: 1, annualCostSavings: 155000, hoursSaved: 1100, users: 10 },
          { team: 'SMB CS', workflows: 2, tasks: 6, experiments: 1, annualCostSavings: 85000, hoursSaved: 650, users: 8 },
          { team: 'Onboarding', workflows: 1, tasks: 3, experiments: 0, annualCostSavings: 45000, hoursSaved: 350, users: 4 }
        ],
        'Support': [
          { team: 'Tier 1', workflows: 2, tasks: 6, experiments: 1, annualCostSavings: 105000, hoursSaved: 850, users: 8 },
          { team: 'Tier 2', workflows: 2, tasks: 4, experiments: 1, annualCostSavings: 85000, hoursSaved: 650, users: 5 },
          { team: 'Technical Support', workflows: 1, tasks: 2, experiments: 0, annualCostSavings: 55000, hoursSaved: 400, users: 3 }
        ],
        'Product': [
          { team: 'Core Product', workflows: 2, tasks: 3, experiments: 1, annualCostSavings: 125000, hoursSaved: 950, users: 8 },
          { team: 'Analytics', workflows: 2, tasks: 3, experiments: 0, annualCostSavings: 90000, hoursSaved: 650, users: 6 }
        ],
        'Finance': [
          { team: 'FP&A', workflows: 1, tasks: 2, experiments: 1, annualCostSavings: 88000, hoursSaved: 650, users: 6 },
          { team: 'Accounting', workflows: 1, tasks: 1, experiments: 0, annualCostSavings: 70000, hoursSaved: 550, users: 6 }
        ],
        'HR': [
          { team: 'Recruiting', workflows: 1, tasks: 1, experiments: 0, annualCostSavings: 120000, hoursSaved: 1020, users: 14 }
        ]
      },
      byMethodType: [
        { type: 'Drafting', count: 52, icon: 'âœï¸' },
        { type: 'Summarizing', count: 38, icon: 'ðŸ“' },
        { type: 'Analyzing', count: 28, icon: 'ðŸ“Š' },
        { type: 'Q&A', count: 24, icon: 'ðŸ”' },
        { type: 'Coding', count: 18, icon: 'ðŸ’»' },
        { type: 'Automation', count: 14, icon: 'âš™ï¸' },
        { type: 'Classifying', count: 12, icon: 'ðŸ·ï¸' },
        { type: 'Vibe Coding', count: 8, icon: 'ðŸŽ¯' }
      ],
      byTool: [
        { tool: 'ChatGPT', count: 89, color: COLORS.primary },
        { tool: 'Claude', count: 62, color: COLORS.secondary },
        { tool: 'Gemini', count: 18, color: COLORS.accent1 },
        { tool: 'Gong', count: 12, color: COLORS.purple },
        { tool: 'Other', count: 13, color: COLORS.slate }
      ],
      impactTypes: [
        { type: 'Cost Savings', count: 79, color: COLORS.success },
        { type: 'Time Savings', count: 133, color: COLORS.primary },
        { type: 'Quality Improvement', count: 27, color: COLORS.purple },
        { type: 'New Capability', count: 18, color: COLORS.warning }
      ]
    };

    const formatCurrency = (value) => {
      if (value >= 1000000) return '$' + (value / 1000000).toFixed(1) + 'M';
      if (value >= 1000) return '$' + Math.round(value / 1000) + 'K';
      return '$' + value;
    };
    const formatNumber = (value) => new Intl.NumberFormat('en-US').format(value);

    // Navigation Button
    function NavButton({ label, icon: Icon, isActive, onClick, disabled, tooltip }) {
      return (
        <div className="tooltip-wrapper" data-tooltip={tooltip}>
          <button
            onClick={onClick}
            disabled={disabled}
            className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-all ${
              isActive
                ? 'text-white shadow-md'
                : disabled
                  ? 'bg-gray-100 text-gray-400 cursor-not-allowed'
                  : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 hover:border-gray-400'
            }`}
            style={isActive ? { backgroundColor: COLORS.primary } : {}}
          >
            <Icon className="w-4 h-4" />
            {label}
          </button>
        </div>
      );
    }

    // Stat Card with optional stacked bar
    function StatCard({ title, titleSub, value, valueSub, icon: Icon, color, showStackedBar, stackData }) {
      const total = stackData ? stackData.reduce((sum, d) => sum + d.value, 0) : 0;
      
      return (
        <div className="bg-white rounded-2xl border border-gray-200 p-5 shadow-sm">
          <div className="flex items-start justify-between">
            <div className="flex-1 pr-2">
              <p className="text-gray-700 text-sm font-medium leading-tight">{title}</p>
              {titleSub && <p className="text-gray-400 text-xs mt-0.5">{titleSub}</p>}
              <p className="text-3xl font-bold text-gray-900 mt-2">{value}</p>
              {valueSub && <p className="text-gray-500 text-sm mt-1">{valueSub}</p>}
            </div>
            <div className="w-11 h-11 rounded-xl flex items-center justify-center flex-shrink-0" style={{ backgroundColor: color + '20' }}>
              <Icon className="w-5 h-5" style={{ color: color }} />
            </div>
          </div>
          {showStackedBar && stackData && (
            <div className="mt-4 overflow-hidden">
              <div className="flex h-2.5 rounded-full overflow-hidden bg-gray-100">
                {stackData.map((item, idx) => (
                  <div 
                    key={idx}
                    style={{ width: (item.value / total * 100) + '%', backgroundColor: item.color }}
                    title={item.label + ': ' + item.value}
                  ></div>
                ))}
              </div>
              <div className="flex flex-wrap gap-x-3 gap-y-1 mt-2">
                {stackData.map((item, idx) => (
                  <div key={idx} className="flex items-center gap-1">
                    <div className="w-2 h-2 rounded-full flex-shrink-0" style={{ backgroundColor: item.color }}></div>
                    <span className="text-gray-600 text-xs whitespace-nowrap">{item.label}: {item.value}</span>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      );
    }

    // Category Card - Updated with Time Savings (experiments don't show cost/time savings)
    function CategoryCard({ title, data, color, icon: Icon, isExperiment = false }) {
      const hasImpactBreakdown = data.impactBreakdown && Object.keys(data.impactBreakdown).length > 0;

      return (
        <div className="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm">
          <div className="flex items-center gap-3 mb-4">
            <div className="w-10 h-10 rounded-xl flex items-center justify-center" style={{ backgroundColor: color + '20' }}>
              <Icon className="w-5 h-5" style={{ color: color }} />
            </div>
            <h3 className="text-lg font-semibold text-gray-900">{title}</h3>
          </div>

          {isExperiment ? (
            <div>
              <p className="text-3xl font-bold text-gray-900">{data.count}</p>
              <p className="text-gray-500 text-sm">Total Count</p>
              <p className="text-gray-400 text-xs mt-2 italic">Experiments don't track cost/time savings</p>
            </div>
          ) : (
            <div className="grid grid-cols-3 gap-4">
              <div>
                <p className="text-3xl font-bold text-gray-900">{data.count}</p>
                <p className="text-gray-500 text-sm">Total Count</p>
              </div>
              <div>
                <p className="text-2xl font-bold" style={{ color: COLORS.success }}>{formatCurrency(data.annualCostSavings || 0)}</p>
                <p className="text-gray-500 text-sm">Cost Savings</p>
              </div>
              <div>
                <p className="text-2xl font-bold" style={{ color: COLORS.primary }}>{formatNumber(data.hoursSaved || 0)}</p>
                <p className="text-gray-500 text-sm">Hours Saved</p>
              </div>
            </div>
          )}

          {hasImpactBreakdown && !isExperiment && (
            <div className="mt-4 pt-4 border-t border-gray-200">
              <p className="text-gray-700 text-xs font-semibold mb-3 uppercase tracking-wide">AI Method Impact Breakdown (count)</p>
              <div className="space-y-2 text-sm">
                <div className="flex items-center">
                  <span className="text-gray-900 font-bold w-8">{data.impactBreakdown.cost_savings || 0}</span>
                  <span className="text-gray-600">Cost Savings</span>
                </div>
                <div className="flex items-center">
                  <span className="text-gray-900 font-bold w-8">{data.impactBreakdown.time_savings || 0}</span>
                  <span className="text-gray-600">Time Savings</span>
                </div>
                <div className="flex items-center">
                  <span className="text-gray-900 font-bold w-8">{data.impactBreakdown.quality || 0}</span>
                  <span className="text-gray-600">Quality Improvement</span>
                </div>
                <div className="flex items-center">
                  <span className="text-gray-900 font-bold w-8">{data.impactBreakdown.new_capability || 0}</span>
                  <span className="text-gray-600">New Capability</span>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // Generic Horizontal Bar Chart
    function HorizontalBarChart({ data, title, subtitle, dataKey, formatter, color }) {
      const max = Math.max(...data.map(d => d[dataKey]));

      // Calculate bar width with better distinction between zero and non-zero
      const getBarWidth = (value) => {
        if (value === 0 || !value) {
          // Zero values get a minimal width just for the text
          return '12%';
        }
        // Non-zero values: minimum 25% width, scales up to 100%
        // This ensures non-zero is always visibly larger than zero
        const percentage = (value / max) * 100;
        return Math.max(percentage, 25) + '%';
      };

      return (
        <div className="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm">
          <h3 className="text-lg font-semibold text-gray-900">{title}</h3>
          {subtitle && <p className="text-gray-400 text-xs mt-0.5 mb-4">{subtitle}</p>}
          {!subtitle && <div className="mb-4"></div>}
          <div className="space-y-3">
            {data.map((item, idx) => {
              const value = item[dataKey];
              const isZero = value === 0 || !value;
              return (
                <div key={idx} className="flex items-center gap-3">
                  <div className="w-28 text-sm text-gray-700 truncate font-medium">{item.function}</div>
                  <div className="flex-1 flex items-center gap-2">
                    <div
                      className="h-7 rounded flex items-center px-3"
                      style={{
                        width: getBarWidth(value),
                        backgroundColor: isZero ? color + '40' : color
                      }}
                    >
                      <span className={`text-xs font-bold ${isZero ? 'text-gray-600' : 'text-white'}`}>
                        {formatter ? formatter(value) : value}
                      </span>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      );
    }

    // Method Details Modal
    function MethodDetailsModal({ isOpen, onClose, functionName, methodType, methods, loading, config }) {
      if (!isOpen) return null;

      const methodTypeLabel = methodType === 'workflow' ? 'Workflows' : methodType === 'task' ? 'Tasks' : 'Experiments';
      const methodTypeColor = methodType === 'workflow' ? COLORS.secondary : methodType === 'task' ? COLORS.primary : COLORS.primaryLight;

      // Get capability name from config
      const getCapabilityName = (capId) => {
        if (!config || !config.capabilities) return 'Unknown';
        const cap = config.capabilities.find(c => c.id === capId);
        return cap ? cap.name : 'Unknown';
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={onClose}>
          <div className="bg-white rounded-2xl shadow-xl max-w-5xl w-full max-h-[85vh] overflow-hidden" onClick={(e) => e.stopPropagation()}>
            {/* Header */}
            <div className="px-6 py-4 border-b border-gray-200 flex items-center justify-between" style={{ backgroundColor: methodTypeColor + '10' }}>
              <div>
                <h3 className="text-xl font-bold text-gray-900">{functionName} - {methodTypeLabel}</h3>
                <p className="text-sm text-gray-600">{loading ? 'Loading...' : methods.length + ' AI method' + (methods.length !== 1 ? 's' : '')}</p>
              </div>
              <button onClick={onClose} className="p-2 hover:bg-gray-200 rounded-lg transition-colors">
                <X className="w-5 h-5 text-gray-500" />
              </button>
            </div>

            {/* Table */}
            <div className="overflow-auto max-h-[calc(85vh-80px)]">
              {loading ? (
                <div className="p-8 text-center text-gray-500">Loading methods...</div>
              ) : methods.length === 0 ? (
                <div className="p-8 text-center text-gray-500">
                  No {methodTypeLabel.toLowerCase()} recorded for {functionName}
                </div>
              ) : (
                <table className="w-full">
                  <thead className="bg-gray-50 sticky top-0">
                    <tr className="text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                      <th className="px-6 py-3">AI Capability</th>
                      <th className="px-6 py-3">Description</th>
                      <th className="px-6 py-3 text-right">Cost Savings</th>
                      <th className="px-6 py-3 text-right">Time Savings</th>
                      <th className="px-6 py-3 text-center">Quality</th>
                      <th className="px-6 py-3 text-center">New Capability</th>
                    </tr>
                  </thead>
                  <tbody className="divide-y divide-gray-200">
                    {methods.map((method) => {
                      const costSavings = (method.impact1_type === 'cost_savings' ? method.impact1_annual_value : 0) +
                                          (method.impact2_type === 'cost_savings' ? method.impact2_annual_value : 0) +
                                          (method.impact3_type === 'cost_savings' ? method.impact3_annual_value : 0) +
                                          (method.impact4_type === 'cost_savings' ? method.impact4_annual_value : 0);
                      const timeSavings = (method.impact1_type === 'time_savings' ? method.impact1_annual_value : 0) +
                                          (method.impact2_type === 'time_savings' ? method.impact2_annual_value : 0) +
                                          (method.impact3_type === 'time_savings' ? method.impact3_annual_value : 0) +
                                          (method.impact4_type === 'time_savings' ? method.impact4_annual_value : 0);
                      const hasQuality = method.impact1_type === 'quality' || method.impact2_type === 'quality' ||
                                         method.impact3_type === 'quality' || method.impact4_type === 'quality';
                      const hasNewCapability = method.impact1_type === 'new_capability' || method.impact2_type === 'new_capability' ||
                                               method.impact3_type === 'new_capability' || method.impact4_type === 'new_capability';

                      return (
                        <tr key={method.id} className="hover:bg-gray-50">
                          <td className="px-6 py-4">
                            <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" style={{ backgroundColor: COLORS.primary + '20', color: COLORS.secondary }}>
                              {getCapabilityName(method.capability_id)}
                            </span>
                          </td>
                          <td className="px-6 py-4 text-sm text-gray-700 max-w-md">{method.description}</td>
                          <td className="px-6 py-4 text-sm text-right font-medium" style={{ color: costSavings > 0 ? COLORS.success : '#9ca3af' }}>
                            {costSavings > 0 ? formatCurrency(costSavings) : '-'}
                          </td>
                          <td className="px-6 py-4 text-sm text-right font-medium" style={{ color: timeSavings > 0 ? COLORS.primary : '#9ca3af' }}>
                            {timeSavings > 0 ? formatNumber(Math.round(timeSavings)) + ' hrs' : '-'}
                          </td>
                          <td className="px-6 py-4 text-center">
                            {hasQuality ? (
                              <span className="inline-flex items-center justify-center w-6 h-6 rounded-full" style={{ backgroundColor: COLORS.purple + '20' }}>
                                <Check className="w-4 h-4" style={{ color: COLORS.purple }} />
                              </span>
                            ) : (
                              <span className="text-gray-300">-</span>
                            )}
                          </td>
                          <td className="px-6 py-4 text-center">
                            {hasNewCapability ? (
                              <span className="inline-flex items-center justify-center w-6 h-6 rounded-full" style={{ backgroundColor: COLORS.warning + '20' }}>
                                <Check className="w-4 h-4" style={{ color: COLORS.warning }} />
                              </span>
                            ) : (
                              <span className="text-gray-300">-</span>
                            )}
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              )}
            </div>
          </div>
        </div>
      );
    }

    // Methods Bar Chart with stacked bars
    function MethodsBarChart({ data, title, subtitle, onSegmentClick }) {
      const max = Math.max(...data.map(d => d.workflows + d.tasks + d.experiments));
      return (
        <div className="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm">
          <h3 className="text-lg font-semibold text-gray-900">{title}</h3>
          {subtitle && <p className="text-gray-400 text-xs mt-0.5">{subtitle}</p>}
          <div className="flex gap-4 mt-3 mb-4 text-sm">
            <div className="flex items-center gap-2">
              <div className="w-3 h-3 rounded" style={{ backgroundColor: COLORS.secondary }}></div>
              <span className="text-gray-600">Workflows</span>
            </div>
            <div className="flex items-center gap-2">
              <div className="w-3 h-3 rounded" style={{ backgroundColor: COLORS.primary }}></div>
              <span className="text-gray-600">Tasks</span>
            </div>
            <div className="flex items-center gap-2">
              <div className="w-3 h-3 rounded" style={{ backgroundColor: COLORS.primaryLight }}></div>
              <span className="text-gray-600">Experiments</span>
            </div>
          </div>
          <div className="space-y-3">
            {data.map((item, idx) => {
              const total = item.workflows + item.tasks + item.experiments;
              const isAllZero = total === 0;

              // For all-zero case, show a minimal faded bar
              if (isAllZero) {
                return (
                  <div key={idx} className="flex items-center gap-3">
                    <div className="w-28 text-sm text-gray-700 truncate font-medium">{item.function}</div>
                    <div className="flex-1 flex items-center">
                      <div className="flex h-7 rounded overflow-hidden" style={{ width: '10%', backgroundColor: COLORS.slate + '30' }}>
                        <span className="w-full flex items-center justify-center text-gray-500 text-xs font-bold">0</span>
                      </div>
                    </div>
                  </div>
                );
              }

              return (
                <div key={idx} className="flex items-center gap-3">
                  <div className="w-28 text-sm text-gray-700 truncate font-medium">{item.function}</div>
                  <div className="flex-1 flex items-center">
                    <div className="flex h-7 rounded overflow-hidden" style={{ width: Math.max((total / max) * 100, 20) + '%' }}>
                      {item.workflows > 0 && (
                        <div
                          className="h-full flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity"
                          style={{ width: (item.workflows / total * 100) + '%', backgroundColor: COLORS.secondary }}
                          onClick={() => onSegmentClick && onSegmentClick(item.function, item.functionId, 'workflow')}
                          title={`Click to view ${item.function} Workflows`}
                        >
                          <span className="text-white text-xs font-bold pointer-events-none">{item.workflows}</span>
                        </div>
                      )}
                      {item.tasks > 0 && (
                        <div
                          className="h-full flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity"
                          style={{ width: (item.tasks / total * 100) + '%', backgroundColor: COLORS.primary }}
                          onClick={() => onSegmentClick && onSegmentClick(item.function, item.functionId, 'task')}
                          title={`Click to view ${item.function} Tasks`}
                        >
                          <span className="text-white text-xs font-bold pointer-events-none">{item.tasks}</span>
                        </div>
                      )}
                      {item.experiments > 0 && (
                        <div
                          className="h-full flex items-center justify-center cursor-pointer hover:opacity-80 transition-opacity"
                          style={{ width: (item.experiments / total * 100) + '%', backgroundColor: COLORS.primaryLight }}
                          onClick={() => onSegmentClick && onSegmentClick(item.function, item.functionId, 'experiment')}
                          title={`Click to view ${item.function} Experiments`}
                        >
                          <span className="text-gray-700 text-xs font-bold pointer-events-none">{item.experiments}</span>
                        </div>
                      )}
                    </div>
                    <span className="ml-2 text-gray-600 text-sm font-medium">{total}</span>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      );
    }

    // Donut Chart
    function DonutChart({ data, title }) {
      const total = data.reduce((sum, d) => sum + d.count, 0);
      if (total === 0) {
        return (
          <div className="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm">
            <h3 className="text-lg font-semibold text-gray-900 mb-4">{title}</h3>
            <div className="flex items-center justify-center h-36 text-gray-400">No data available</div>
          </div>
        );
      }
      let cumulative = 0;

      const gradientStops = data.map(d => {
        const start = (cumulative / total) * 100;
        cumulative += d.count;
        const end = (cumulative / total) * 100;
        return d.color + ' ' + start + '% ' + end + '%';
      }).join(', ');

      return (
        <div className="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm">
          <h3 className="text-lg font-semibold text-gray-900 mb-4">{title}</h3>
          <div className="flex items-center justify-center gap-8">
            <div className="relative w-36 h-36">
              <div
                className="w-full h-full rounded-full"
                style={{ background: 'conic-gradient(' + gradientStops + ')' }}
              ></div>
              <div className="absolute inset-0 flex items-center justify-center">
                <div className="w-20 h-20 rounded-full bg-white flex items-center justify-center">
                  <span className="text-2xl font-bold text-gray-900">{total}</span>
                </div>
              </div>
            </div>
            <div className="space-y-2">
              {data.map((item, idx) => (
                <div key={idx} className="flex items-center gap-2">
                  <div className="w-3 h-3 rounded" style={{ backgroundColor: item.color }}></div>
                  <span className="text-gray-700 text-sm">{item.type || item.tool}</span>
                  <span className="text-gray-900 font-bold text-sm">{item.count}</span>
                </div>
              ))}
            </div>
          </div>
        </div>
      );
    }

    // Capabilities Horizontal Bar Chart
    function CapabilitiesChart({ data, title }) {
      if (!data || data.length === 0) {
        return (
          <div className="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm">
            <h3 className="text-lg font-semibold text-gray-900 mb-4">{title}</h3>
            <div className="flex items-center justify-center h-36 text-gray-400">No data available</div>
          </div>
        );
      }
      const max = Math.max(...data.map(d => d.count));
      return (
        <div className="bg-white rounded-2xl border border-gray-200 p-6 shadow-sm">
          <h3 className="text-lg font-semibold text-gray-900 mb-4">{title}</h3>
          <div className="space-y-3">
            {data.map((item, idx) => (
              <div key={idx} className="flex items-center gap-3">
                <div className="w-28 text-sm text-gray-700 truncate font-medium">{item.capability}</div>
                <div className="flex-1 flex items-center gap-2">
                  <div className="h-7 rounded flex items-center px-3" style={{ width: Math.max((item.count / max) * 100, 18) + '%', backgroundColor: COLORS.accent1 }}>
                    <span className="text-white text-xs font-bold">{item.count}</span>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    // Function Row - handles functions with or without teams
    function FunctionRow({ data, isExpanded, onToggle }) {
      const hasTeams = data.teams && data.teams.length > 0;
      const showExpandButton = hasTeams;

      return (
        <div className="border-b border-gray-200 last:border-0">
          <button
            onClick={showExpandButton ? onToggle : undefined}
            className={`w-full px-6 py-4 flex items-center justify-between transition-colors ${showExpandButton ? 'hover:bg-gray-50 cursor-pointer' : 'cursor-default'}`}
          >
            <div className="flex items-center gap-4">
              {showExpandButton ? (
                isExpanded ? <ChevronDown className="w-5 h-5" style={{ color: COLORS.primary }} /> : <ChevronRight className="w-5 h-5 text-gray-400" />
              ) : (
                <span className="w-5 h-5"></span>
              )}
              <span className="text-gray-900 font-medium">
                {data.function}
                {data.hasNoTeams && <span className="text-gray-400 text-xs ml-2">(no teams)</span>}
              </span>
            </div>
            <div className="flex items-center gap-6 text-sm">
              <div className="text-center w-16"><span className="font-semibold" style={{ color: COLORS.secondary }}>{data.workflows}</span><span className="text-gray-500 text-xs ml-1">wf</span></div>
              <div className="text-center w-16"><span className="font-semibold" style={{ color: COLORS.primary }}>{data.tasks}</span><span className="text-gray-500 text-xs ml-1">tasks</span></div>
              <div className="text-center w-16"><span className="font-semibold" style={{ color: COLORS.primaryLight }}>{data.experiments}</span><span className="text-gray-500 text-xs ml-1">exp</span></div>
              <div className="text-center w-20"><span className="font-semibold" style={{ color: COLORS.success }}>{formatCurrency(data.annualCostSavings)}</span></div>
              <div className="text-center w-20"><span className="font-semibold" style={{ color: COLORS.primary }}>{formatNumber(data.hoursSaved)}</span><span className="text-gray-500 text-xs ml-1">hrs</span></div>
            </div>
          </button>
          {isExpanded && hasTeams && (
            <div className="bg-gray-50 px-6 py-3 border-t border-gray-200">
              <table className="w-full">
                <thead>
                  <tr className="text-xs text-gray-500 uppercase tracking-wider">
                    <th className="text-left py-2 pl-10">Team</th>
                    <th className="text-center py-2">Workflows</th>
                    <th className="text-center py-2">Tasks</th>
                    <th className="text-center py-2">Experiments</th>
                    <th className="text-center py-2">Cost Savings</th>
                    <th className="text-center py-2">Time Savings</th>
                  </tr>
                </thead>
                <tbody>
                  {data.teams.map((team, idx) => (
                    <tr key={idx} className="text-sm border-t border-gray-200">
                      <td className="py-3 pl-10 text-gray-700">{team.team}</td>
                      <td className="py-3 text-center font-medium" style={{ color: COLORS.secondary }}>{team.workflows}</td>
                      <td className="py-3 text-center font-medium" style={{ color: COLORS.primary }}>{team.tasks}</td>
                      <td className="py-3 text-center font-medium" style={{ color: COLORS.primaryLight }}>{team.experiments}</td>
                      <td className="py-3 text-center font-medium" style={{ color: COLORS.success }}>{formatCurrency(team.annualCostSavings)}</td>
                      <td className="py-3 text-center font-medium" style={{ color: COLORS.primary }}>{formatNumber(team.hoursSaved)}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      );
    }

    // Main Dashboard
    function AIDashboard() {
      const [expandedFunctions, setExpandedFunctions] = useState({});
      const [activeNav, setActiveNav] = useState('overview');
      const [loading, setLoading] = useState(true);
      const [dashboardData, setDashboardData] = useState({
        summary: { total_methods: 0, total_workflows: 0, total_tasks: 0, total_experiments: 0, total_cost_savings: 0, total_time_savings: 0, quality_count: 0, new_capability_count: 0 },
        byFunction: [],
        byTeam: [],
        impactTypes: [],
        toolsUsed: [],
        capabilities: [],
        byCategory: { workflow: { count: 0, cost_savings: 0, time_savings: 0, impact_breakdown: {} }, task: { count: 0, cost_savings: 0, time_savings: 0, impact_breakdown: {} }, experiment: { count: 0, cost_savings: 0, time_savings: 0, impact_breakdown: {} } },
        functionsWithTeams: []
      });
      const [config, setConfig] = useState(null);
      const [modalData, setModalData] = useState({ isOpen: false, functionName: '', methodType: '', methods: [], loading: false });
      const [currentUser, setCurrentUser] = useState(null);

      useEffect(() => {
        fetch('/api/auth/me')
          .then(res => res.ok ? res.json() : null)
          .then(data => setCurrentUser(data))
          .catch(() => setCurrentUser(null));
      }, []);

      const handleLogout = async () => {
        await fetch('/api/auth/logout', { method: 'POST' });
        window.location.href = '/login';
      };

      useEffect(() => {
        async function fetchData() {
          try {
            const [summaryRes, byFunctionRes, byTeamRes, impactTypesRes, toolsUsedRes, capabilitiesRes, byCategoryRes, functionsWithTeamsRes, configRes] = await Promise.all([
              fetch('/api/dashboard/summary'),
              fetch('/api/dashboard/by-function'),
              fetch('/api/dashboard/by-team'),
              fetch('/api/dashboard/impact-types'),
              fetch('/api/dashboard/tools-used'),
              fetch('/api/dashboard/capabilities'),
              fetch('/api/dashboard/by-category'),
              fetch('/api/dashboard/functions-with-teams'),
              fetch('/api/config')
            ]);
            const summary = await summaryRes.json();
            const byFunction = await byFunctionRes.json();
            const byTeam = await byTeamRes.json();
            const impactTypes = await impactTypesRes.json();
            const toolsUsed = await toolsUsedRes.json();
            const capabilities = await capabilitiesRes.json();
            const byCategory = await byCategoryRes.json();
            const functionsWithTeams = await functionsWithTeamsRes.json();
            const configData = await configRes.json();
            setDashboardData({ summary, byFunction, byTeam, impactTypes, toolsUsed, capabilities, byCategory, functionsWithTeams });
            setConfig(configData);
          } catch (error) {
            console.error('Error fetching dashboard data:', error);
          } finally {
            setLoading(false);
          }
        }
        fetchData();
      }, []);

      const toggleFunction = (func) => setExpandedFunctions(prev => ({ ...prev, [func]: !prev[func] }));

      const handleSegmentClick = async (functionName, functionId, methodType) => {
        setModalData({ isOpen: true, functionName, methodType, methods: [], loading: true });
        try {
          const res = await fetch(`/api/responses?function_id=${functionId}&method_type=${methodType}`);
          const methods = await res.json();
          setModalData({ isOpen: true, functionName, methodType, methods, loading: false });
        } catch (error) {
          console.error('Error fetching methods:', error);
          setModalData({ isOpen: true, functionName, methodType, methods: [], loading: false });
        }
      };

      const closeModal = () => setModalData({ isOpen: false, functionName: '', methodType: '', methods: [], loading: false });

      const totalMethods = dashboardData.summary.total_workflows + dashboardData.summary.total_tasks + dashboardData.summary.total_experiments;

      const stackData = [
        { label: 'Workflows', value: dashboardData.summary.total_workflows, color: COLORS.secondary },
        { label: 'Tasks', value: dashboardData.summary.total_tasks, color: COLORS.primary },
        { label: 'Experiments', value: dashboardData.summary.total_experiments, color: COLORS.primaryLight }
      ];

      // Transform API data to match component expectations
      const byFunctionData = dashboardData.byFunction.map(f => ({
        function: f.function_name,
        functionId: f.function_id,
        workflows: f.workflow_count || 0,
        tasks: f.task_count || 0,
        experiments: f.experiment_count || 0,
        annualCostSavings: f.cost_savings || 0,
        hoursSaved: f.time_savings || 0,
        qualityImpact: f.quality_count || 0,
        newCapability: f.new_capability_count || 0
      }));

      // Group teams by function name using functionsWithTeams data
      const byFunctionWithTeamsData = dashboardData.functionsWithTeams.map(f => ({
        function: f.function_name,
        function_id: f.function_id,
        workflows: f.workflow_count || 0,
        tasks: f.task_count || 0,
        experiments: f.experiment_count || 0,
        annualCostSavings: f.cost_savings || 0,
        hoursSaved: f.time_savings || 0,
        qualityImpact: f.quality_count || 0,
        newCapability: f.new_capability_count || 0,
        teams: (f.teams || []).map(t => ({
          team: t.team_name,
          workflows: t.workflow_count || 0,
          tasks: t.task_count || 0,
          experiments: t.experiment_count || 0,
          annualCostSavings: t.cost_savings || 0,
          hoursSaved: t.time_savings || 0
        })),
        hasNoTeams: f.has_no_teams || false
      }));

      // Category data from API
      const byCategory = {
        workflows: {
          count: dashboardData.byCategory.workflow?.count || 0,
          annualCostSavings: dashboardData.byCategory.workflow?.cost_savings || 0,
          hoursSaved: dashboardData.byCategory.workflow?.time_savings || 0,
          impactBreakdown: dashboardData.byCategory.workflow?.impact_breakdown || {}
        },
        tasks: {
          count: dashboardData.byCategory.task?.count || 0,
          annualCostSavings: dashboardData.byCategory.task?.cost_savings || 0,
          hoursSaved: dashboardData.byCategory.task?.time_savings || 0,
          impactBreakdown: dashboardData.byCategory.task?.impact_breakdown || {}
        },
        experimentation: {
          count: dashboardData.byCategory.experiment?.count || 0,
          annualCostSavings: dashboardData.byCategory.experiment?.cost_savings || 0,
          hoursSaved: dashboardData.byCategory.experiment?.time_savings || 0,
          impactBreakdown: dashboardData.byCategory.experiment?.impact_breakdown || {}
        }
      };

      // Impact types data with colors
      const impactTypesData = dashboardData.impactTypes.map(item => ({
        type: item.type,
        count: item.count,
        color: item.type === 'Cost Savings' ? COLORS.success :
               item.type === 'Time Savings' ? COLORS.primary :
               item.type === 'Quality Improvement' ? COLORS.purple : COLORS.warning
      }));

      // Tools used data with colors
      const toolColors = [COLORS.primary, COLORS.secondary, COLORS.accent1, COLORS.purple, COLORS.slate, COLORS.warning, COLORS.success];
      const toolsUsedData = dashboardData.toolsUsed.map((item, idx) => ({
        tool: item.tool,
        count: item.count,
        color: toolColors[idx % toolColors.length]
      }));

      // Capabilities data
      const capabilitiesData = dashboardData.capabilities;

      if (loading) {
        return (
          <div className="min-h-screen bg-gray-50 flex items-center justify-center">
            <div className="text-gray-500">Loading dashboard data...</div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-50">
          <div className="max-w-7xl mx-auto px-6 py-8">
            {/* Header */}
            <div className="mb-6">
              <div className="flex items-center justify-between mb-2">
                <div className="flex items-center gap-3">
                  <img src="/static/logo/workboard-logo-icon.png" className="h-10 w-auto" alt="WorkBoard" />
                  <h1 className="text-2xl font-bold text-gray-900">WorkBoard's Internal AI Usage and Impact Catalog (v2.0)</h1>
                </div>
                {currentUser && (
                  <div className="flex items-center gap-4">
                    <div className="flex items-center gap-2 text-gray-600">
                      <User className="w-5 h-5" />
                      <span className="text-sm font-medium">{currentUser.username}</span>
                      {currentUser.role === 'admin' && (
                        <span className="px-2 py-0.5 text-xs font-medium rounded-full bg-purple-100 text-purple-700">Admin</span>
                      )}
                    </div>
                    <button
                      onClick={handleLogout}
                      className="flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"
                    >
                      <LogOut className="w-4 h-4" />
                      Sign Out
                    </button>
                  </div>
                )}
              </div>
            </div>

            {/* Navigation Buttons */}
            <div className="flex flex-wrap gap-3 mb-8">
              <NavButton
                label="Overview"
                icon={BarChart3}
                isActive={false}
                onClick={() => window.location.href = '/'}
                tooltip="Preview dashboard with sample data"
              />
              <NavButton
                label="Instructions"
                icon={FileText}
                isActive={false}
                onClick={() => window.location.href = '/instructions'}
                tooltip="Learn how to fill out the form"
              />
              <NavButton
                label="Live Dashboard"
                icon={ExternalLink}
                isActive={true}
                onClick={() => window.location.href = '/dashboard'}
                tooltip="View WorkBoard's AI Usage and Impact Dashboard"
              />
              <NavButton
                label="Enter Your AI Use Cases"
                icon={PlusCircle}
                isActive={false}
                onClick={() => window.location.href = '/form'}
                tooltip="Submit your AI workflows, tasks, and experiments"
              />
              <NavButton
                label="Manage Entries"
                icon={Settings}
                isActive={false}
                onClick={() => window.location.href = '/admin'}
                tooltip="Edit or delete submitted entries"
              />
              <NavButton
                label="Configuration"
                icon={Sliders}
                isActive={false}
                onClick={() => window.location.href = '/config'}
                tooltip="Edit functions, teams, AI tools and AI capabilities"
              />
              {currentUser && currentUser.role === 'admin' && (
                <NavButton
                  label="Users"
                  icon={Users}
                  isActive={false}
                  onClick={() => window.location.href = '/users'}
                  tooltip="Manage user accounts"
                />
              )}
            </div>

            {/* Summary Cards */}
            <div className="grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6">
              <StatCard 
                title="Total AI Methods in Use"
                titleSub={"as of " + TODAY_DATE}
                value={totalMethods}
                icon={Layers} 
                color={COLORS.primary}
                showStackedBar={true}
                stackData={stackData}
              />
              <StatCard
                title="Estimated Annual Cost Savings"
                value={formatCurrency(dashboardData.summary.total_cost_savings)}
                icon={DollarSign}
                color={COLORS.success}
              />
              <StatCard
                title="Estimated Annual Time Savings"
                value={formatNumber(dashboardData.summary.total_time_savings)}
                valueSub="hours"
                icon={Clock}
                color={COLORS.primary}
              />
              <StatCard
                title="AI Methods with Quality Impact"
                value={dashboardData.summary.quality_count}
                valueSub="Improved quality outcomes"
                icon={Award}
                color={COLORS.purple}
              />
              <StatCard
                title="AI Methods with New Capability"
                value={dashboardData.summary.new_capability_count}
                valueSub="Work we couldn't do before"
                icon={Zap}
                color={COLORS.warning}
              />
            </div>

            {/* Charts Row 1: Cost Savings and Time Savings by Function */}
            {byFunctionData.length > 0 && (
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
              <HorizontalBarChart
                data={byFunctionData}
                title="Estimated Annual Cost Savings by Function"
                dataKey="annualCostSavings"
                formatter={formatCurrency}
                color={COLORS.success}
              />
              <HorizontalBarChart
                data={byFunctionData}
                title="Estimated Annual Time Savings by Function"
                dataKey="hoursSaved"
                formatter={(v) => formatNumber(v) + ' hrs'}
                color={COLORS.primary}
              />
            </div>
            )}

            {/* Charts Row 2: Quality Impact and New Capability by Function */}
            {byFunctionData.length > 0 && (
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
              <HorizontalBarChart
                data={byFunctionData}
                title="AI Methods with Quality Impact by Function"
                dataKey="qualityImpact"
                color={COLORS.purple}
              />
              <HorizontalBarChart
                data={byFunctionData}
                title="AI Methods with New Capability by Function"
                dataKey="newCapability"
                color={COLORS.warning}
              />
            </div>
            )}

            {/* Charts Row 3: Total AI Methods by Function */}
            {byFunctionData.length > 0 && (
            <div className="grid grid-cols-1 gap-6 mb-8">
              <MethodsBarChart
                data={byFunctionData}
                title="Total AI Methods in Use by Function"
                subtitle={"as of " + TODAY_DATE + " â€” click on chart segment for details"}
                onSegmentClick={handleSegmentClick}
              />
            </div>
            )}

            {/* Category Cards */}
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-8">
              <CategoryCard title="Workflows" data={byCategory.workflows} color={COLORS.secondary} icon={Layers} />
              <CategoryCard title="Tasks" data={byCategory.tasks} color={COLORS.primary} icon={CheckCircle2} />
              <CategoryCard title="Experiments" data={byCategory.experimentation} color={COLORS.primaryLight} icon={Sparkles} isExperiment={true} />
            </div>

            {/* Charts Row: Impact Types and Tools Used */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
              <DonutChart
                data={impactTypesData}
                title="AI Method Impact Type Distribution"
              />
              <DonutChart
                data={toolsUsedData}
                title="AI Tools Used"
              />
            </div>

            {/* AI Capabilities Used - Full Width */}
            <div className="mb-8">
              <CapabilitiesChart
                data={capabilitiesData}
                title="AI Capabilities Used"
              />
            </div>

            {/* Function & Team Breakdown */}
            <div className="bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm">
              <div className="px-6 py-4 border-b border-gray-200 flex flex-col sm:flex-row sm:items-center justify-between gap-3">
                <div className="flex items-center gap-3">
                  <Building2 className="w-5 h-5" style={{ color: COLORS.primary }} />
                  <h3 className="text-lg font-semibold text-gray-900">Breakdown by Function & Team</h3>
                </div>
                <div className="flex items-center gap-2 text-sm px-4 py-2 rounded-lg border" style={{ backgroundColor: COLORS.primary + '10', borderColor: COLORS.primary + '30', color: COLORS.secondary }}>
                  <MousePointerClick className="w-4 h-4" />
                  <span className="font-medium">Click on a function to see team details</span>
                </div>
              </div>

              <div className="px-6 py-3 bg-gray-50 border-b border-gray-200 flex items-center justify-between text-xs text-gray-600 uppercase tracking-wider font-medium">
                <div className="flex items-center gap-4">
                  <span className="w-5"></span>
                  <span>Function</span>
                </div>
                <div className="flex items-center gap-6">
                  <span className="w-16 text-center">Workflows</span>
                  <span className="w-16 text-center">Tasks</span>
                  <span className="w-16 text-center">Experiments</span>
                  <span className="w-20 text-center">Cost Savings</span>
                  <span className="w-20 text-center">Time Savings</span>
                </div>
              </div>

              <div>
                {byFunctionWithTeamsData.map((func) => (
                  <FunctionRow key={func.function} data={func} isExpanded={expandedFunctions[func.function]} onToggle={() => toggleFunction(func.function)} />
                ))}
              </div>
            </div>

            <div className="mt-8 text-center text-gray-500 text-sm">
              Data sourced from AI Usage Intake Form â€¢ Last updated: {TODAY_DATE}
            </div>
          </div>

          {/* Method Details Modal */}
          <MethodDetailsModal
            isOpen={modalData.isOpen}
            onClose={closeModal}
            functionName={modalData.functionName}
            methodType={modalData.methodType}
            methods={modalData.methods}
            loading={modalData.loading}
            config={config}
          />
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<AIDashboard />);
  </script>
</body>
</html>
